<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Report</title>
    <style>
        #weather-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 20px;
        }

        #report {
            white-space: pre-line;
            max-width: 60%;
        }

        #weather-icon {
            max-width: 120px;
            max-height: 120px;
            object-fit: contain;
        }
    </style>
</head>
<body>

<div>
    <h2>Weather Lookup</h2>
    <input type="text" id="location" placeholder="Enter city (e.g., Ottawa)">
    <button onclick="getWeather()">Get Current Weather</button>
</div>

<hr>

<div id="weather-container">
    <div id="report"></div>
    <img id="weather-icon" src="" alt="Weather Icon">
</div>

<script>
    async function getWeather() {
        const loc = document.getElementById("location").value.trim();
        const reportDiv = document.getElementById("report");
        const iconImg = document.getElementById("weather-icon");

        if (!loc) {
            reportDiv.textContent = "Please enter a location.";
            iconImg.src = "";
            return;
        }

        try {
            const response = await fetch(`http://localhost:8000/weather?location=${encodeURIComponent(loc)}`);
            if (!response.ok) throw new Error("Network response was not ok");

            const data = await response.json();
            const locData = data.location;
            const w = data.weather;

            // Format the text report
            reportDiv.textContent = `
📍 Location: ${locData.city_name}, ${locData.region_name}, ${locData.country_name}
🌐 Coordinates: ${locData.latitude}, ${locData.longitude}

🕒 Daytime: ${w.isDay ? "Yes" : "No"}

🌡 Temperature:
   - ${w.temperature[0]}°C (Feels like ${w.feels_like[0]}°C)
   - ${w.temperature[1]}°F (Feels like ${w.feels_like[1]}°F)

💧 Dew Point:
   - ${w.dew_point[0]}°C | ${w.dew_point[1]}°F

🌬 Wind:
   - ${w.wind_speed[0]} km/h | ${w.wind_speed[1]} mph
   - Direction: ${w.wind_heading} (${w.wind_degree}°)

📊 Pressure & Humidity:
   - ${w.air_pressure[0]} mb | ${w.air_pressure[1]} inHg
   - Humidity: ${w.humidity}%

☁️ Condition:
   - ${w.condition}
   - Cloud Cover: ${w.cloud_coverage}%
   - Visibility: ${w.visibility[0]} km | ${w.visibility[1]} mi
`;

            // Fix icon URL (prepend https if needed)
            let iconUrl = w.icon_source;
            if (iconUrl.startsWith("//")) {
                iconUrl = "https:" + iconUrl;
            }
            iconImg.src = iconUrl;
            iconImg.alt = w.condition;

        } catch (error) {
            reportDiv.textContent = "Error fetching weather: " + error.message;
            iconImg.src = "";
        }
    }
</script>

</body>
</html>
